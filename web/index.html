<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HoneyBee</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: #f0f0f0;
    }

    .navbar {
      position: relative;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      padding: 20px 40px;
      background-color: #121212;
      position: sticky;
      top: 0;
      z-index: 10;
      height: 60px;
      box-sizing: border-box;
    }

    .logo {
      font-size: 24px;
      font-weight: bold;
      flex-shrink: 0;
      display: flex;
      align-items: center;
    }

    .logo span.h { color: #FFD54F; }
    .logo span.b { color: #FFB74D; }

    .categories {
      display: flex;
      gap: 10px;
      font-size: 16px;
      margin-left: 40px;
      position: relative;
      align-items: center;
    }

    .categories > div {
      cursor: pointer;
      padding: 4px 8px;
      position: relative;
      user-select: none;
      color: #f0f0f0;
      white-space: nowrap;
    }

    .categories > div > span {
      color: inherit;
      transition: color 0.2s;
    }

    .categories > div:hover > span,
    .categories > div.active > span {
      color: #FFD54F;
    }

    #stats-tab {
      cursor: pointer;
      margin-left: 10px;
      color: #f0f0f0;
      user-select: none;
    }

    #stats-tab.active {
      color: #FFD54F;
    }

    .subcategories-container {
      position: absolute;
      background: transparent;
      padding: 0;
      color: #ccc;
      display: none;
      gap: 18px;
      font-size: 14px;
      white-space: nowrap;
      z-index: 20;
      top: 100%;
      left: 0;
    }

    .subcategories-container span {
      cursor: pointer;
      color: #ccc;
      transition: color 0.2s;
    }

    .subcategories-container span:hover,
    .subcategories-container span.active {
      color: #FFD54F;
    }

    #search-container {
      padding: 40px 40px 10px 40px;
      background-color: #121212;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #search-input {
      width: 100%;
      max-width: 600px;
      padding: 10px 14px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      outline: none;
      background-color: #2a2a2a;
      color: #f0f0f0;
    }

    #search-input::placeholder {
      color: #999;
    }

    .popular-keywords {
      display: flex;
      gap: 12px;
      margin-top: 16px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .popular-keywords span {
      background-color: #2a2a2a;
      padding: 6px 14px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
      color: #f0f0f0;
      transition: background-color 0.2s;
    }

    .popular-keywords span:hover {
      background-color: #3a3a3a;
    }

    .card-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      padding: 40px;
    }

    .card {
      background-color: #1e1e1e;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
      cursor: pointer;
      transition: transform 0.2s;
    }

    .card:hover {
      transform: scale(1.02);
    }

    .card img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 8px;
    }

    .card h3 {
      font-size: 16px;
      font-weight: 450;
      margin: 12px 0 8px;
      color: #fff;
    }

    .card p {
      font-size: 12px;
      font-weight: 450;
      color: #f3db8d;
      margin: 2px 0;
    }

    /* í†µê³„ ìŠ¤íƒ€ì¼ */
    #statistics-container {
      padding: 40px;
      color: #f0f0f0;
    }

    #stats-filters {
      margin-bottom: 20px;
    }

    #stats-filters button {
      background-color: #2a2a2a;
      border: none;
      color: #f0f0f0;
      padding: 6px 14px;
      margin-right: 10px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }

    #stats-filters button:hover,
    #stats-filters button.active {
      background-color: #FFD54F;
      color: #121212;
    }

    #stats-results {
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
      justify-content: flex-start;
    }

    #stats-results > div {
      flex: 1;
      min-width: 180px;
      max-width: 280px;
    }

    #stats-results h3 {
      margin-top: 0;
      margin-bottom: 10px;
      color: #FFD54F;
      font-size: 18px;
      border-bottom: 1px solid #FFD54F;
      padding-bottom: 4px;
    }

    #stats-results ol {
      padding-left: 20px;
      margin: 0;
    }

    #stats-results li {
      margin-bottom: 4px;
      font-size: 14px;
    }

  </style>
</head>

<body>
  <div class="navbar">
    <div class="logo">
      ğŸ¯ <span class="h">H</span>oney<span class="b">B</span>ee
    </div>
    <div class="categories" id="categories">
      <div data-cat="ì „ì²´"><span>ì „ì²´</span></div>
      <div data-cat="AI"><span>AI</span></div>
      <div data-cat="ê°œë°œ"><span>ê°œë°œ</span></div>
      <div data-cat="ê¸°íš"><span>ê¸°íš</span></div>
      <div data-cat="ê²Œì„"><span>ê²Œì„</span></div>
      <div data-cat="ë””ìì¸"><span>ë””ìì¸</span></div>
      <div data-cat="ë¹„ì¦ˆë‹ˆìŠ¤"><span>ë¹„ì¦ˆë‹ˆìŠ¤</span></div>
      <div id="stats-tab">í†µê³„</div>
    </div>
  </div>

  <div id="subcategories" class="subcategories-container"></div>

  <div id="search-container">
    <input
      type="text"
      id="search-input"
      placeholder="ğŸ” ì–´ë–¤ í‚¤ì›Œë“œë¥¼ ì°¾ê³  ìˆë‚˜ìš”?"
      autocomplete="off"
    />
    <div class="popular-keywords">
      <span onclick="applyKeyword('ê°ìì–´ë©ˆ')">ê°ìì–´ë©ˆ</span>
      <span onclick="applyKeyword('AI')">AI</span>
      <span onclick="applyKeyword('ë‚˜í´ë ˆì˜¹')">ë‚˜í´ë ˆì˜¹</span>
    </div>
  </div>

  <div id="card-container" class="card-container"></div>

  <div id="statistics-container" style="display:none;">
    <div id="stats-filters">
      <button data-period="7">1ì£¼ì¼</button>
      <button data-period="30" class="active">1ê°œì›”</button>
      <button data-period="90">3ê°œì›”</button>
      <button data-period="180">6ê°œì›”</button>
      <button data-period="365">1ë…„</button>
    </div>
    <div id="stats-results"></div>
  </div>

  <script>
    const categories = document.getElementById('categories');
    const subcategories = document.getElementById('subcategories');
    const cardContainer = document.getElementById('card-container');
    const searchInput = document.getElementById('search-input');
    const popularKeywords = document.querySelector('.popular-keywords');
    const statisticsContainer = document.getElementById('statistics-container');
    const statsTab = document.getElementById('stats-tab');
    const statsFilters = document.getElementById('stats-filters');
    const statsResults = document.getElementById('stats-results');

    const subcatMap = {
      "ì „ì²´": [],
      "AI": ["ìƒì„±í˜• AI", "LLM", "AI ë„êµ¬"],
      "ê°œë°œ": ["í”„ë¡ íŠ¸ì—”ë“œ", "ë°±ì—”ë“œ", "ëª¨ë°”ì¼"],
      "ê¸°íš": [],
      "ê²Œì„": [],
      "ë””ìì¸": [],
      "ë¹„ì¦ˆë‹ˆìŠ¤": []
    };

    let activeCat = null;
    let activeSubcat = null;
    let posts = [];

    fetch('../data/posts.json')
      .then(response => response.json())
      .then(data => {
        posts = data;
        renderCards();
      })
      .catch(err => {
        console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', err);
      });

    categories.querySelectorAll('div[data-cat]').forEach(catEl => {
      catEl.addEventListener('click', () => {
        // í†µê³„ íƒ­ì´ë©´ ì—¬ê¸°ì„œ ë¬´ì‹œë¨
        if (catEl.id === 'stats-tab') return;

        // í†µê³„ íƒ­ active ì œê±°
        statsTab.classList.remove('active');
        statisticsContainer.style.display = 'none';
        cardContainer.style.display = 'grid';
        searchInput.style.display = 'block';
        popularKeywords.style.display = 'flex';

        searchInput.value = '';

        if (activeCat === catEl.dataset.cat) {
          activeCat = null;
          activeSubcat = null;
          catEl.classList.remove('active');
          subcategories.style.display = 'none';
          renderCards();
          return;
        }

        categories.querySelectorAll('div').forEach(el => el.classList.remove('active'));
        activeSubcat = null;

        activeCat = catEl.dataset.cat;
        catEl.classList.add('active');

        const subs = subcatMap[activeCat] || [];
        if (subs.length > 0) {
          subcategories.innerHTML = '';
          subs.forEach(sub => {
            const span = document.createElement('span');
            span.textContent = sub;
            span.dataset.subcat = sub;
            span.addEventListener('click', (e) => {
              e.stopPropagation();
              if (activeSubcat === sub) {
                activeSubcat = null;
                span.classList.remove('active');
                subcategories.style.display = 'none';
              } else {
                activeSubcat = sub;
                subcategories.querySelectorAll('span').forEach(s => s.classList.remove('active'));
                span.classList.add('active');
                subcategories.style.display = 'flex';
              }
              renderCards();
            });
            subcategories.appendChild(span);
          });

          const rect = catEl.getBoundingClientRect();
          const navRect = categories.getBoundingClientRect();

          subcategories.style.display = 'flex';
          subcategories.style.top = `${rect.bottom - navRect.top + 12}px`;
          subcategories.style.left = `${rect.left - navRect.left + 225}px`;
          subcategories.style.width = `auto`;
        } else {
          subcategories.style.display = 'none';
          subcategories.innerHTML = '';
        }
        renderCards();
      });
    });

    // í†µê³„ íƒ­ í´ë¦­ ì´ë²¤íŠ¸
    statsTab.addEventListener('click', () => {
      // ëª¨ë“  ì¹´í…Œê³ ë¦¬ active í•´ì œ
      categories.querySelectorAll('div').forEach(el => el.classList.remove('active'));
      statsTab.classList.add('active');

      activeCat = null;
      activeSubcat = null;

      searchInput.value = '';
      searchInput.style.display = 'none';
      popularKeywords.style.display = 'none';

      subcategories.style.display = 'none';

      // ì¹´ë“œ ì˜ì—­ ìˆ¨ê¸°ê³  í†µê³„ ì˜ì—­ ë³´ì´ê¸°
      cardContainer.style.display = 'none';
      statisticsContainer.style.display = 'block';

      // ê¸°ë³¸ ê¸°ê°„ 30ì¼(1ê°œì›”)ë¡œ í†µê³„ ë Œë”ë§
      setActiveFilterButton(30);
      renderStatistics(30);
    });

    // ê²€ìƒ‰ì°½ ì…ë ¥ ì´ë²¤íŠ¸
    searchInput.addEventListener('input', () => {
      renderCards();
    });

    // ì¸ê¸° í‚¤ì›Œë“œ í´ë¦­ ì‹œ ê²€ìƒ‰ ì ìš© í•¨ìˆ˜
    function applyKeyword(word) {
      searchInput.value = word;
      activeCat = null;  // ì „ì²´ í•„í„° ì—†ì´ ê²€ìƒ‰ì–´ë§Œ ì ìš©
      activeSubcat = null;

      // ì¹´í…Œê³ ë¦¬ active ëª¨ë‘ í•´ì œ
      document.querySelectorAll('#categories > div').forEach(el => el.classList.remove('active'));
      statsTab.classList.remove('active');

      subcategories.style.display = 'none';
      renderCards();
    }

    // ì¹´ë“œ ë Œë”ë§ í•¨ìˆ˜
    function renderCards() {
      cardContainer.innerHTML = '';

      let filteredPosts = posts;

      if (activeCat && activeCat !== 'ì „ì²´') {
        filteredPosts = filteredPosts.filter(post => post.category === activeCat);
      }

      if (activeSubcat) {
        filteredPosts = filteredPosts.filter(post => post.subcategory === activeSubcat);
      }

      const keyword = searchInput.value.trim().toLowerCase();
      if (keyword.length > 0) {
        filteredPosts = filteredPosts.filter(post => {
          return (
            (post.title && post.title.toLowerCase().includes(keyword)) ||
            (post.author && post.author.toLowerCase().includes(keyword)) ||
            (post.category && post.category.toLowerCase().includes(keyword)) ||
            (post.subcategory && post.subcategory.toLowerCase().includes(keyword)) ||
            (post.source && post.source.toLowerCase().includes(keyword))
          );
        });
      }

      filteredPosts.forEach(post => {
        const card = document.createElement('div');
        card.classList.add('card');

        card.innerHTML = `
          <img src="${post.image_url || 'https://via.placeholder.com/300x200?text=No+Image'}" alt="thumbnail" />
          <h3>${post.title}</h3>
          <p>${post.author} | ${post.date}</p>
        `;

        card.onclick = () => {
          window.open(post.link, '_blank');
        };

        cardContainer.appendChild(card);
      });
    }

    // í†µê³„ í•„í„° ë²„íŠ¼ í´ë¦­ ì²˜ë¦¬
    statsFilters.addEventListener('click', e => {
      if (e.target.tagName === 'BUTTON') {
        const days = parseInt(e.target.dataset.period, 10);
        setActiveFilterButton(days);
        renderStatistics(days);
      }
    });

    // ë²„íŠ¼ active ìƒíƒœ ë³€ê²½ í•¨ìˆ˜
    function setActiveFilterButton(days) {
      statsFilters.querySelectorAll('button').forEach(btn => {
        btn.classList.toggle('active', parseInt(btn.dataset.period, 10) === days);
      });
    }

    // í†µê³„ ë Œë”ë§ í•¨ìˆ˜
    function renderStatistics(days) {
      const now = new Date();
      const cutoff = new Date(now.getTime() - days * 24 * 60 * 60 * 1000);

      // ê¸°ê°„ ë‚´ ê¸€ í•„í„°ë§
      const filtered = posts.filter(post => new Date(post.date) >= cutoff);

      // ì‘ì„±ì, í‚¤ì›Œë“œ, ì¹´í…Œê³ ë¦¬, ì¶œì²˜ ì§‘ê³„ í•¨ìˆ˜
      function countByField(field) {
        const counts = {};
        filtered.forEach(post => {
          if (post[field]) {
            if (field === 'keywords' && Array.isArray(post[field])) {
              post[field].forEach(kw => {
                counts[kw] = (counts[kw] || 0) + 1;
              });
            } else {
              counts[post[field]] = (counts[post[field]] || 0) + 1;
            }
          }
        });
        return counts;
      }

      const authorCounts = countByField('author');
      const keywordCounts = countByField('keywords');
      const categoryCounts = countByField('category');
      const sourceCounts = countByField('source');

      // ì •ë ¬ ë° ìƒìœ„ 10ê°œ ì¶”ì¶œ í•¨ìˆ˜
      function getTop10(counts) {
        return Object.entries(counts)
          .sort((a,b) => b[1] - a[1])
          .slice(0, 10);
      }

      // HTML ìƒì„± í•¨ìˆ˜
      function createRankingHTML(title, data) {
        if (data.length === 0) return `<div><h3>${title}</h3><p>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>`;
        return `
          <div>
            <h3>${title}</h3>
            <ol>
              ${data.map(([key, count]) => `<li>${key} â€” ${count}ê±´</li>`).join('')}
            </ol>
          </div>
        `;
      }

      statsResults.innerHTML =
        createRankingHTML('ì‘ì„±ì ë­í‚¹', getTop10(authorCounts)) +
        createRankingHTML('í‚¤ì›Œë“œ ë­í‚¹', getTop10(keywordCounts)) +
        createRankingHTML('ì¹´í…Œê³ ë¦¬ ë­í‚¹', getTop10(categoryCounts)) +
        createRankingHTML('ì¶œì²˜ ë­í‚¹', getTop10(sourceCounts));
    }
  </script>
</body>
</html>
